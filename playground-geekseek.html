<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Geekseek Playground</title>
    <style>
      :root {
        --bg: #0f1220;
        --panel: #161a2e;
        --panel-soft: #1f2440;
        --text: #e6eaf2;
        --muted: #919abc;
        --accent: #7aa2f7;
        --accent-soft: rgba(122, 162, 247, 0.15);
        --ok: #38d39f;
        --warn: #f7c948;
        --err: #ff6b6b;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, rgba(122, 162, 247, 0.2), transparent 45%), var(--bg);
        color: var(--text);
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 32px 16px 64px;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 26px;
      }
      p.lead {
        margin: 0 0 20px;
        color: var(--muted);
      }
      .panel {
        background: var(--panel);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        padding: 20px;
        margin-bottom: 18px;
      }
      .tab-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 16px;
      }
      .tab-bar button {
        flex: 1 1 140px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        background: var(--panel-soft);
        color: var(--muted);
        padding: 10px 14px;
        font-weight: 600;
        cursor: pointer;
      }
      .tab-bar button.active {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--text);
      }
      .mode-panel {
        display: none;
        flex-direction: column;
        gap: 12px;
      }
      .mode-panel.active {
        display: flex;
      }
      label {
        font-size: 12px;
        letter-spacing: 0.08em;
        color: var(--muted);
        text-transform: uppercase;
      }
      textarea {
        width: 100%;
        min-height: 100px;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: #0d1121;
        color: var(--text);
        font-size: 14px;
        padding: 12px;
        resize: vertical;
        outline: none;
      }
      button.primary {
        border: none;
        border-radius: 12px;
        background: var(--accent);
        color: #060916;
        padding: 12px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 8px;
      }
      button.primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .note {
        font-size: 12px;
        color: var(--muted);
      }
      .results-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .status {
        font-size: 13px;
        color: var(--muted);
      }
      .status.ok {
        color: var(--ok);
      }
      .status.warn {
        color: var(--warn);
      }
      .status.err {
        color: var(--err);
      }
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 14px;
        margin-top: 16px;
      }
      .card-entry {
        background: var(--panel-soft);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 14px;
      }
      .card-entry h3 {
        margin: 0 0 6px;
        font-size: 16px;
      }
      .card-entry .muted {
        color: var(--muted);
        font-size: 13px;
      }
      table.compare {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-size: 13px;
      }
      table.compare th,
      table.compare td {
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 8px;
        text-align: left;
      }
      table.compare th {
        background: rgba(255, 255, 255, 0.05);
      }
      .links {
        display: grid;
        gap: 6px;
        margin-top: 12px;
      }
      .links a {
        color: var(--accent);
        text-decoration: none;
        font-size: 13px;
      }
      pre#rawOut {
        margin-top: 16px;
        border-radius: 12px;
        background: #0d1121;
        color: var(--muted);
        padding: 12px;
        font-size: 12px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Geekseek Playground</h1>
      <p class="lead">Quickly exercise every Geekseek mode using only plain text prompts.</p>

      <div class="panel">
        <div class="tab-bar">
          <button type="button" class="active" data-tab="places">Places</button>
          <button type="button" data-tab="compare.tech">Compare Tech</button>
          <button type="button" data-tab="compare.product">Compare Product</button>
        </div>

        <form id="form-places" class="mode-panel active">
          <div>
            <label for="input-places">Places query</label>
            <textarea id="input-places" placeholder="Example: quiet coffee shops with Wi-Fi near Mitte" required></textarea>
            <div class="note">Calls <code>/api/geekseek</code> with the query as-is.</div>
          </div>
          <button type="submit" class="primary">Search Places</button>
        </form>

        <form id="form-tech" class="mode-panel">
          <div>
            <label for="input-tech">Tech comparison prompt</label>
            <textarea
              id="input-tech"
              placeholder="Example: Compare Pinecone, Weaviate, Milvus for realtime RAG workloads"
              required
            ></textarea>
            <div class="note">Calls <code>/api/geekseek?type=compare.tech</code>. Mention items inline or comma separated.</div>
          </div>
          <button type="submit" class="primary">Compare Tech</button>
        </form>

        <form id="form-product" class="mode-panel">
          <div>
            <label for="input-product">Product comparison prompt</label>
            <textarea
              id="input-product"
              placeholder="Example: Compare the latest flagship noise-cancelling headphones for remote work"
              required
            ></textarea>
            <div class="note">Calls <code>/api/geekseek?type=compare.product</code>.</div>
          </div>
          <button type="submit" class="primary">Compare Products</button>
        </form>
      </div>

      <div class="panel">
        <div class="results-header">
          <strong>Results</strong>
          <span id="status" class="status">idle</span>
        </div>
        <div id="cards" class="cards"></div>
        <pre id="rawOut"></pre>
      </div>
    </div>

    <script>
      const API_URL = "/api/geekseek";
      const tabs = document.querySelectorAll("[data-tab]");
      const panels = document.querySelectorAll(".mode-panel");
      const statusEl = document.getElementById("status");
      const cardsEl = document.getElementById("cards");
      const rawEl = document.getElementById("rawOut");

      function setStatus(text, tone = "") {
        statusEl.textContent = text;
        statusEl.className = `status ${tone}`.trim();
      }

      function setActiveTab(tab) {
        tabs.forEach((btn) => btn.classList.toggle("active", btn.dataset.tab === tab));
        panels.forEach((panel) => panel.classList.toggle("active", panel.id === panelId(tab)));
        resetResults();
      }

      function panelId(tab) {
        if (tab === "compare.tech") return "form-tech";
        if (tab === "compare.product") return "form-product";
        return "form-places";
      }

      function resetResults() {
        cardsEl.innerHTML = "";
        cardsEl.classList.remove("comparison");
        rawEl.textContent = "";
        setStatus("idle");
      }

      tabs.forEach((btn) =>
        btn.addEventListener("click", () => {
          setActiveTab(btn.dataset.tab);
        })
      );

      document.getElementById("form-places").addEventListener("submit", async (event) => {
        event.preventDefault();
        await requestPlaces(document.getElementById("input-places").value.trim());
      });

      document.getElementById("form-tech").addEventListener("submit", async (event) => {
        event.preventDefault();
        await requestComparison("compare.tech", document.getElementById("input-tech").value.trim());
      });

      document.getElementById("form-product").addEventListener("submit", async (event) => {
        event.preventDefault();
        await requestComparison("compare.product", document.getElementById("input-product").value.trim());
      });

      async function requestPlaces(query) {
        if (!query) return setStatus("Enter a query", "err");
        setStatus("Fetching places…", "warn");
        const params = new URLSearchParams({ q: query, type: "places" });
        try {
          const response = await fetch(`${API_URL}?${params.toString()}`, { headers: { Accept: "application/json" } });
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const payload = await response.json();
          rawEl.textContent = JSON.stringify(payload, null, 2);
          renderPlaces(payload.items || payload.results || []);
        } catch (error) {
          console.error(error);
          setStatus(error.message || "Request failed", "err");
        }
      }

      function renderPlaces(items) {
        cardsEl.innerHTML = "";
        cardsEl.classList.remove("comparison");
        if (!items.length) {
          setStatus("No places", "warn");
          return;
        }
        setStatus(`${items.length} places`, "ok");
        items.slice(0, 12).forEach((place) => {
          const div = document.createElement("div");
          div.className = "card-entry";
          const href = place.googleMapsUri || place.websiteUri || "#";
          const rating =
            typeof place.rating === "number"
              ? `<div class="muted">⭐ ${place.rating.toFixed(1)} (${place.userRatingCount ?? 0})</div>`
              : "";
          div.innerHTML = `
            <h3>${place.name ?? "Untitled"}</h3>
            <div class="muted">${place.address ?? ""}</div>
            ${rating}
            ${href !== "#" ? `<a href="${href}" target="_blank" rel="noopener">Open map/site</a>` : ""}
          `;
          cardsEl.appendChild(div);
        });
      }

      async function requestComparison(type, query) {
        if (!query) return setStatus("Enter a prompt", "err");
        setStatus("Building comparison…", "warn");
        const params = new URLSearchParams({ type, q: query });
        try {
          const response = await fetch(`${API_URL}?${params.toString()}`, { headers: { Accept: "application/json" } });
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const payload = await response.json();
          rawEl.textContent = JSON.stringify(payload, null, 2);
          renderComparison(payload);
        } catch (error) {
          console.error(error);
          setStatus(error.message || "Request failed", "err");
        }
      }

      function renderComparison(payload) {
        cardsEl.classList.add("comparison");
        cardsEl.innerHTML = "";
        const block = document.createElement("div");
        block.className = "card-entry";
        const items = payload.items || [];
        const pillRow = items.length
          ? `<div class="note" style="margin-bottom:8px;">${items.map((item) => `<span style="margin-right:8px;">${item}</span>`).join("")}</div>`
          : "";
        const tableHtml = payload.table?.html || payload.description || "";
        const highlights = (payload.highlights || [])
          .map(
            (h) => `<div style="margin-top:10px;">
              <strong>${h.item || "Highlight"}</strong>
              <div class="muted">${h.summary || ""}</div>
            </div>`
          )
          .join("");
        const links = (payload.links || [])
          .map((link) => `<a href="${link.url}" target="_blank" rel="noopener">${link.label || link.url}</a>`)
          .join("");
        block.innerHTML = `
          ${pillRow}
          ${tableHtml || "<div class='muted'>No table returned.</div>"}
          ${highlights}
          ${payload.summary ? `<div style="margin-top:12px;">${payload.summary}</div>` : ""}
          ${links ? `<div class="links">${links}</div>` : ""}
        `;
        cardsEl.appendChild(block);
        setStatus("Comparison ready", "ok");
      }

      setActiveTab("places");
    </script>
  </body>
</html>
